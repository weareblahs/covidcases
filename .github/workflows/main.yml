name: Update cases
on:
  schedule:
  # GitHub Actions uses UTC. This time is converted from MYT to UTC.
  - cron: "0 */1 * * *"
  workflow_dispatch:
  
jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      -     uses: szenius/set-timezone@v1.0
            with:
                timezoneLinux: "Asia/Kuala_Lumpur"
      - name: Check if jq is installed - if not then install
        run: sudo apt-get install jq
      - name: Check if imagemagick for images is installed - if not then install
        run: sudo apt-get install imagemagick
      - name: Install Roboto font for images
        run: sudo apt-get install fonts-roboto
      - name: Install FFMPEG for image conversion
        run: sudo apt-get install ffmpeg
      - name: Start updating
        run: |
         cd $GITHUB_WORKSPACE
         chmod +x update.sh
         sh update.sh
      - name: Commit to GitHub
        run: |
         echo Pushing to GitHub...
         git config --global user.email "tanyuxuan2005@gmail.com"
         git config --global user.name "weareblahs/covidcases auto update bot"
         git add .
         git commit -m "Update cases and deaths"
         git push
