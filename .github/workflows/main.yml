name: Update cases
on:
  schedule:
  # GitHub Actions uses UTC. This time is converted from MYT to UTC.
  - cron: "0 */1 * * *"
  workflow_dispatch:
  
jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      -     uses: szenius/set-timezone@v1.0
            with:
                timezoneLinux: "Asia/Kuala_Lumpur"
      - name: Check if jq is installed - if not then install
        run: sudo apt-get install jq
      - name: Check if imagemagick for images is installed - if not then install
        run: sudo apt-get install imagemagick
      - name: Download Helvetica font for images
        run: curl -o "https://raw.githubusercontent.com/Santoshah/example_fonts/master/Helvetica/Helvetica%2065%20Medium.ttf"
      - name: Start updating
        run: |
         cd $GITHUB_WORKSPACE
         chmod +x update.sh
         sh update.sh
      - name: Commit to GitHub
        run: |
         echo Pushing to GitHub...
         git config --global user.email "tanyuxuan2005@gmail.com"
         git config --global user.name "weareblahs/covidcases auto update bot"
         dateandtime=$( date +"%d %b %Y %H:%M:%S GMT+8" ) 
         git add .
         git commit -m "Update cases and deaths ($dateandtime)"
         git push
